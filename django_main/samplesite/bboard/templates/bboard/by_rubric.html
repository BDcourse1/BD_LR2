{% extends "layout/basic.html" %} 

{% block title %}{{ current_rubric.name }}{% endblock %}

{% block content %}
<h2>Рубрика: {{ current_rubric.name }}</h2>

{% for bb in bbs %}
<div class="bb-card" style="border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
    <h2>{{ bb.title }}</h2>
    <p>{{ bb.content }}</p>

    <p>Цена: <strong>{{ bb.price|floatformat:2 }}</strong> руб.</p>

    <p>Теги:
        {% for tag in bb.tags.all %}
            <span>#{{ tag.name }}</span>
        {% empty %}
            <span>Нет тегов</span>
        {% endfor %}
    </p>

    <p>
        Оценка:
        {% if bb.average_rating %}
            <strong>{{ bb.average_rating|floatformat:1 }}</strong>
            (на основе {{ bb.rating_count }} голосов)
        {% else %}
            Нет оценок
        {% endif %}
    </p>

    {% if bb.bbdetail %}
    <p>Просмотров: {{ bb.bbdetail.views_count }}</p>
    {% else %}
    <p>Просмотров: 0</p>
    {% endif %}

    {# --- БЛОК ХАРАКТЕРИСТИК (Аналогично index.html) --- #}
    {% if bb.features.all %}
    <div class="features-block" style="background-color: #f9f9f9; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff;">
        <strong>Характеристики:</strong>
        <ul style="margin: 5px 0 0 0; padding-left: 20px;">
            {% for feature in bb.features.all %}
                <li><strong>{{ feature.name }}:</strong> {{ feature.value }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {# -------------------------------------------------- #}

    <p style="color: gray; font-size: 0.8em;">{{ bb.published|date:"d.m.Y H:i:s" }}</p>
</div>
{% endfor %}

{% if not bbs %}
    <p>В этой рубрике пока нет объявлений.</p>
{% endif %}

{% endblock %}